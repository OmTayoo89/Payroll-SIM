<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll & Executive Performance System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --narbara-blue: #002347; --narbara-gold: #c5a059; --bg-light: #f4f7fa; --danger: #d63031; --success: #00b894; --white: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-light); margin: 0; }
        .navbar { background: var(--narbara-blue); display: flex; padding: 0 50px; gap: 30px; position: sticky; top: 0; z-index: 1000; }
        .nav-brand { color: white; font-size: 24px; font-weight: 800; display: flex; align-items: center; height: 70px; letter-spacing: 1.5px; }
        .nav-item { color: rgba(255,255,255,0.7); padding: 25px 15px; cursor: pointer; font-weight: 600; border-bottom: 4px solid transparent; }
        .nav-item.active { color: white; border-bottom: 4px solid var(--narbara-gold); background: rgba(255,255,255,0.05); }
        .container { padding: 40px 50px; display: none; max-width: 1600px; margin: auto; }
        .container.active { display: block; }
        .grid-main { display: grid; grid-template-columns: 450px 1fr; gap: 40px; }
        .card { background: var(--white); border-radius: 16px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); margin-bottom: 30px; }
        h2 { color: var(--narbara-blue); font-size: 16px; border-left: 5px solid var(--narbara-gold); padding-left: 15px; text-transform: uppercase; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 10px; font-weight: 700; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; border: 2px solid #edf2f7; border-radius: 10px; }
        .btn { padding: 15px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-primary { background: var(--narbara-blue); color: white; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; padding: 15px; text-align: left; font-size: 11px; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .matrix-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: #dfe6e9; padding: 10px; border-radius: 15px; }
        .matrix-box { background: white; height: 90px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; position: relative; border: 2px solid #eee; }
        .count-badge { position: absolute; top: 5px; right: 5px; background: var(--narbara-blue); color: white; padding: 2px 6px; border-radius: 10px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; text-align: center; border-bottom: 5px solid var(--narbara-gold); }
    </style>
</head>
<body>

<div class="navbar">
    <div class="nav-brand">NARBARA HRM</div>
    <div class="nav-item active" id="tab-payroll" onclick="switchTab('payroll')">Payroll Operasional</div>
    <div class="nav-item" id="tab-executive" onclick="switchTab('executive')">Executive Performance</div>
</div>

<div id="payroll" class="container active">
    <div class="grid-main">
        <div class="sidebar">
            <div class="card">
                <h2>Input Data Karyawan</h2>
                <div class="form-group"><label>Nama</label><input type="text" id="in_nama"></div>
                <div class="form-group"><label>Divisi</label><input type="text" id="in_divisi"></div>
                <div class="form-group"><label>Gaji Pokok</label><input type="number" id="in_gajipokok"></div>
                <div class="form-group"><label>Tunjangan</label><input type="number" id="in_tunjangan"></div>
                <div class="form-group">
                    <label>PTKP</label>
                    <select id="in_ptkp">
                        <option value="TK/0">TK/0 (A)</option><option value="TK/1">TK/1 (A)</option>
                        <option value="TK/2">TK/2 (B)</option><option value="TK/3">TK/3 (B)</option>
                        <option value="K/0">K/0 (A)</option><option value="K/1">K/1 (B)</option>
                        <option value="K/2">K/2 (B)</option><option value="K/3">K/3 (C)</option>
                    </select>
                </div>
                <div class="form-group"><label>KPI (0-100)</label><input type="number" id="in_kpi" value="80"></div>
                <button class="btn btn-primary" onclick="processData()">Simpan & Hitung</button>
            </div>
        </div>
        <div class="card">
            <h2>Riwayat Payroll</h2>
            <table id="main_table">
                <thead><tr><th>Nama/Divisi</th><th>Bruto</th><th>Pajak</th><th>Netto</th><th>Aksi</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<div id="executive" class="container">
    <div class="card">
        <h2>Executive Performance Dashboard</h2>
        <div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:20px; align-items:end">
            <div><label>Total Revenue Perusahaan</label><input type="number" id="ex_rev" value="1000000000"></div>
            <div><label>Target Budget Ratio (%)</label><input type="number" id="ex_target" value="20"></div>
            <button class="btn btn-primary" onclick="renderExecutive()">Update Analitik</button>
        </div>
    </div>

    <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; margin-bottom:30px">
        <div class="stat-card"><label>Payroll Expense</label><div id="st_cost" style="font-weight:800;">Rp 0</div></div>
        <div class="stat-card"><label>Budget Ratio</label><div id="st_ratio" style="font-weight:800;">0%</div></div>
        <div class="stat-card"><label>Avg Score Performance</label><div id="st_kpi" style="font-weight:800;">0</div></div>
        <div class="stat-card"><label>Company ROI</label><div id="st_roi" style="font-weight:800;">0x</div></div>
    </div>

    <div class="grid-main" style="grid-template-columns: 1fr 400px">
        <div class="card">
            <h2>Kinerja Berbobot (KPI + Gaji + Revenue)</h2>
            <table id="exec_table">
                <thead><tr><th>Nama</th><th>Skor Akhir</th><th>Status</th><th>Rekomendasi</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <h2>9-Box Talent Matrix</h2>
            <div class="matrix-container" id="matrix_ui">
                <div class="matrix-box"><b>Future Leader</b><span class="count-badge" id="m1">0</span></div>
                <div class="matrix-box"><b>High Potential</b><span class="count-badge" id="m2">0</span></div>
                <div class="matrix-box" style="background:#f0fff4; border-color:var(--success)"><b>STAR ASSET</b><span class="count-badge" id="m3">0</span></div>
                <div class="matrix-box"><b>Enigma</b><span class="count-badge" id="m4">0</span></div>
                <div class="matrix-box"><b>Core Talent</b><span class="count-badge" id="m5">0</span></div>
                <div class="matrix-box"><b>High Prof.</b><span class="count-badge" id="m6">0</span></div>
                <div class="matrix-box" style="background:#fff5f5; border-color:var(--danger)"><b>DANGER ZONE</b><span class="count-badge" id="m7">0</span></div>
                <div class="matrix-box"><b>Underperformer</b><span class="count-badge" id="m8">0</span></div>
                <div class="matrix-box"><b>Solid Performer</b><span class="count-badge" id="m9">0</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    // DATA TER 2024 LENGKAP
    const TER_DATA = {
        'A': [[0, 5400000, 0], [5400000, 5650000, 0.0025], [5650000, 5950000, 0.005], [5950000, 6300000, 0.0075], [6300000, 6750000, 0.01], [6750000, 7500000, 0.0125], [7500000, 8550000, 0.015], [8550000, 9650000, 0.0175], [9650000, 10050000, 0.02], [10050000, 10350000, 0.0225], [10350000, 10700000, 0.025], [10700000, 11050000, 0.03], [11050000, 11600000, 0.035], [11600000, 12500000, 0.04], [12500000, 13750000, 0.05], [13750000, 15100000, 0.06], [15100000, 16950000, 0.07], [16950000, 19750000, 0.08], [19750000, 24150000, 0.09], [24150000, 26450000, 0.10], [26450000, 28000000, 0.11], [28000000, 30050000, 0.12], [30050000, 32400000, 0.13], [32400000, 35400000, 0.14], [35400000, 39100000, 0.15], [39100000, 43850000, 0.16], [43850000, 47800000, 0.17], [47800000, 51400000, 0.18], [51400000, 56300000, 0.19], [56300000, 62200000, 0.20], [62200000, 68600000, 0.21], [68600000, 77500000, 0.22], [77500000, 89000000, 0.23], [89000000, 103000000, 0.24], [103000000, 125000000, 0.25], [125000000, 157000000, 0.26], [157000000, 206000000, 0.27], [206000000, 337000000, 0.28], [337000000, 454000000, 0.29], [454000000, 550000000, 0.30], [550000000, 695000000, 0.31], [695000000, 910000000, 0.32], [910000000, 1400000000, 0.33], [1400000000, 999999999999, 0.34]],
        'B': [[0, 6200000, 0], [6200000, 6500000, 0.0025], [6500000, 6850000, 0.005], [6850000, 7300000, 0.0075], [7300000, 9200000, 0.01], [9200000, 10750000, 0.015], [10750000, 11250000, 0.02], [11250000, 11600000, 0.025], [11600000, 12600000, 0.03], [12600000, 13600000, 0.04], [13600000, 14950000, 0.05], [14950000, 16400000, 0.06], [16400000, 18450000, 0.07], [18450000, 21850000, 0.08], [21850000, 26000000, 0.09], [26000000, 27700000, 0.10], [27700000, 29350000, 0.11], [29350000, 31450000, 0.12], [31450000, 33950000, 0.13], [33950000, 37100000, 0.14], [37100000, 41100000, 0.15], [41100000, 45800000, 0.16], [45800000, 49500000, 0.17], [49500000, 53800000, 0.18], [53800000, 58500000, 0.19], [58500000, 64000000, 0.20], [64000000, 71000000, 0.21], [71000000, 80000000, 0.22], [80000000, 93000000, 0.23], [93000000, 109000000, 0.24], [109000000, 129000000, 0.25], [129000000, 163000000, 0.26], [163000000, 211000000, 0.27], [211000000, 374000000, 0.28], [374000000, 459000000, 0.29], [459000000, 555000000, 0.30], [555000000, 704000000, 0.31], [704000000, 957000000, 0.32], [957000000, 1405000000, 0.33], [1405000000, 999999999999, 0.34]],
        'C': [[0, 6600000, 0], [6600000, 6950000, 0.0025], [6950000, 7350000, 0.005], [7350000, 7800000, 0.0075], [7800000, 8850000, 0.01], [8850000, 9800000, 0.0125], [9800000, 10950000, 0.015], [10950000, 11200000, 0.0175], [11200000, 12050000, 0.02], [12050000, 12950000, 0.03], [12950000, 14150000, 0.04], [14150000, 15550000, 0.05], [15550000, 17050000, 0.06], [17050000, 19500000, 0.07], [19500000, 22700000, 0.08], [22700000, 26600000, 0.09], [26600000, 28100000, 0.10], [28100000, 30100000, 0.11], [30100000, 32600000, 0.12], [32600000, 35400000, 0.13], [35400000, 38900000, 0.14], [38900000, 43000000, 0.15], [43000000, 47400000, 0.16], [47400000, 51200000, 0.17], [51200000, 55800000, 0.18], [55800000, 60400000, 0.19], [60400000, 66700000, 0.20], [66700000, 74500000, 0.21], [74500000, 83200000, 0.22], [83200000, 95600000, 0.23], [95600000, 110000000, 0.24], [110000000, 134000000, 0.25], [134000000, 169000000, 0.26], [169000000, 221000000, 0.27], [221000000, 390000000, 0.28], [390000000, 463000000, 0.29], [463000000, 561000000, 0.30], [561000000, 709000000, 0.31], [709000000, 965000000, 0.32], [965000000, 1419000000, 0.33], [1419000000, 999999999999, 0.34]]
    };

    function switchTab(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('tab-' + id).classList.add('active');
        if(id === 'executive') renderExecutive();
    }

    function processData() {
        const nama = document.getElementById('in_nama').value;
        const gapok = parseFloat(document.getElementById('in_gajipokok').value) || 0;
        const tunj = parseFloat(document.getElementById('in_tunjangan').value) || 0;
        const ptkp = document.getElementById('in_ptkp').value;
        const bruto = gapok + tunj;
        
        let cat = 'A';
        if(['TK/2','TK/3','K/0','K/1','K/2'].includes(ptkp)) cat = 'B';
        if(['K/3'].includes(ptkp)) cat = 'C';
        
        let rate = 0;
        for(let r of TER_DATA[cat]) { if(bruto >= r[0] && bruto < r[1]) { rate = r[2]; break; } }
        
        const pajak = bruto * rate;
        const thp = bruto - pajak;

        const data = { id: Date.now(), nama, divisi: document.getElementById('in_divisi').value, bruto, pajak, thp, kpi: parseFloat(document.getElementById('in_kpi').value) };
        let db = JSON.parse(localStorage.getItem('narbara_db')) || [];
        db.push(data);
        localStorage.setItem('narbara_db', JSON.stringify(db));
        renderTable();
    }

    function renderTable() {
        const db = JSON.parse(localStorage.getItem('narbara_db')) || [];
        const f = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(n);
        document.querySelector('#main_table tbody').innerHTML = db.slice(-5).reverse().map(i => `
            <tr><td>${i.nama}</td><td>${f(i.bruto)}</td><td>${f(i.pajak)}</td><td>${f(i.thp)}</td><td><button onclick="delData(${i.id})">x</button></td></tr>
        `).join('');
    }

    function renderExecutive() {
        const db = JSON.parse(localStorage.getItem('narbara_db')) || [];
        const rev = parseFloat(document.getElementById('ex_rev').value) || 1;
        const targetRatio = parseFloat(document.getElementById('ex_target').value) || 20;
        const f = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(n);
        
        const targetBudgetPerHead = (rev * (targetRatio/100)) / (db.length || 1);
        let tCost = 0, tScore = 0, mCount = new Array(10).fill(0);

        document.querySelector('#exec_table tbody').innerHTML = db.map(i => {
            tCost += i.bruto;
            
            // --- LOGIKA PEMBOBOTAN KINERJA (KPI, GAJI, REVENUE) ---
            const scoreKPI = (i.kpi / 100) * 40; // Bobot 40%
            const scoreGaji = Math.min((targetBudgetPerHead / i.bruto), 1.5) * 30; // Bobot 30% (Efisiensi Gaji)
            const scoreRev = Math.min(((rev / db.length) / i.bruto) / 10, 1) * 30; // Bobot 30% (ROI Revenue)
            
            const totalScore = scoreKPI + scoreGaji + scoreRev;
            tScore += totalScore;

            let status, color, box, rec;
            if (totalScore >= 80) { status = "TOP STAR"; color = "var(--success)"; box = 3; rec = "Promosi/Bonus"; }
            else if (totalScore < 50) { status = "CRITICAL"; color = "var(--danger)"; box = 7; rec = "PIP / Evaluasi"; }
            else { status = "STABLE"; color = "var(--narbara-blue)"; box = 5; rec = "Maintain"; }
            
            mCount[box]++;
            return `<tr><td><b>${i.nama}</b></td><td>${totalScore.toFixed(1)}</td><td style="color:${color}">${status}</td><td>${rec}</td></tr>`;
        }).join('');

        const actualRatio = (tCost/rev)*100;
        document.getElementById('st_cost').innerText = f(tCost);
        document.getElementById('st_ratio').innerText = actualRatio.toFixed(1) + "%";
        document.getElementById('st_ratio').style.color = actualRatio > targetRatio ? 'red' : 'green';
        document.getElementById('st_kpi').innerText = db.length ? (tScore/db.length).toFixed(1) : 0;
        document.getElementById('st_roi').innerText = (rev/tCost).toFixed(1) + "x";
        for(let j=1; j<=9; j++) document.getElementById(`m${j}`).innerText = mCount[j];
    }

    function delData(id) {
        let db = JSON.parse(localStorage.getItem('narbara_db')).filter(x => x.id !== id);
        localStorage.setItem('narbara_db', JSON.stringify(db));
        renderTable();
    }
    window.onload = renderTable;
</script>
</body>
</html>
